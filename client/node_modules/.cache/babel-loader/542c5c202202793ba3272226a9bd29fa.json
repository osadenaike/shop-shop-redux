{"ast":null,"code":"var _jsxFileName = \"/Users/oluz/Desktop/shop-shop-redux/client/src/components/Cart/index.js\";\nimport React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery } from '@apollo/react-hooks';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { toggleCart, addMultipleToCart } from '../../utils/actions';\nimport Auth from '../../utils/auth';\nimport { idbPromise } from '../../utils/helpers';\nimport { loadStripe } from '@stripe/stripe-js';\nimport './style.css';\nimport CartItem from '../CartItem';\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\n\nconst Cart = () => {\n  const state = useSelector(state => state);\n  const dispatch = useDispatch(); // data const will contain checkout session, but only after the query is called with the getCheckout function in the submitCheckout handler\n\n  const [getCheckout, {\n    data\n  }] = useLazyQuery(QUERY_CHECKOUT);\n  useEffect(() => {\n    async function getCart() {\n      const cart = await idbPromise('cart', 'get');\n      dispatch(addMultipleToCart([...cart]));\n    }\n\n    if (!state.cart.length) {\n      getCart();\n    }\n  }, [state.cart.length, dispatch]);\n  useEffect(() => {\n    if (data) {\n      stripePromise.then(res => {\n        res.redirectToCheckout({\n          sessionId: data.checkout.session\n        });\n      });\n    }\n  }, [data]);\n\n  function handleToggleCart() {\n    dispatch(toggleCart());\n  }\n\n  function calculateTotal() {\n    let sum = 0;\n    state.cart.forEach(item => {\n      sum += item.price * item.purchaseQuantity;\n    });\n    return sum.toFixed(2);\n  }\n\n  if (!state.cartOpen) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"cart-closed\",\n      onClick: handleToggleCart,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      role: \"img\",\n      \"aria-label\": \"trash\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 5\n      }\n    }, \"\\uD83D\\uDED2\"));\n  }\n\n  function submitCheckout() {\n    const productIds = [];\n    state.cart.forEach(item => {\n      for (let i = 0; i < item.purchaseQuantity; i++) {\n        productIds.push(item._id);\n      }\n    });\n    getCheckout({\n      variables: {\n        products: productIds\n      }\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cart\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"close\",\n    onClick: handleToggleCart,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 4\n    }\n  }, \"[close]\"), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 4\n    }\n  }, \"Shopping Cart\"), state.cart.length ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 5\n    }\n  }, state.cart.map(item => /*#__PURE__*/React.createElement(CartItem, {\n    key: item._id,\n    item: item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 32\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex-row space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, \"Total: $\", calculateTotal()), Auth.loggedIn() ? /*#__PURE__*/React.createElement(\"button\", {\n    onClick: submitCheckout,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 8\n    }\n  }, \"Checkout\") : /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 8\n    }\n  }, \"(log in to check out)\"))) : /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    role: \"img\",\n    \"aria-label\": \"shocked\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 6\n    }\n  }, \"\\uD83D\\uDE28\"), \"You haven't added anything to your cart yet\"));\n};\n\nexport default Cart;","map":{"version":3,"sources":["/Users/oluz/Desktop/shop-shop-redux/client/src/components/Cart/index.js"],"names":["React","useEffect","useSelector","useDispatch","useLazyQuery","QUERY_CHECKOUT","toggleCart","addMultipleToCart","Auth","idbPromise","loadStripe","CartItem","stripePromise","Cart","state","dispatch","getCheckout","data","getCart","cart","length","then","res","redirectToCheckout","sessionId","checkout","session","handleToggleCart","calculateTotal","sum","forEach","item","price","purchaseQuantity","toFixed","cartOpen","submitCheckout","productIds","i","push","_id","variables","products","map","loggedIn"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useLazyQuery } from '@apollo/react-hooks';\nimport { QUERY_CHECKOUT } from '../../utils/queries';\nimport { toggleCart, addMultipleToCart } from '../../utils/actions';\nimport Auth from '../../utils/auth';\nimport { idbPromise } from '../../utils/helpers';\nimport { loadStripe } from '@stripe/stripe-js';\nimport './style.css';\n\nimport CartItem from '../CartItem';\n\nconst stripePromise = loadStripe('pk_test_TYooMQauvdEDq54NiTphI7jx');\n\nconst Cart = () => {\n\tconst state = useSelector((state) => state);\n\tconst dispatch = useDispatch();\n\n\t// data const will contain checkout session, but only after the query is called with the getCheckout function in the submitCheckout handler\n\tconst [ getCheckout, { data } ] = useLazyQuery(QUERY_CHECKOUT);\n\n\tuseEffect(\n\t\t() => {\n\t\t\tasync function getCart() {\n\t\t\t\tconst cart = await idbPromise('cart', 'get');\n\t\t\t\tdispatch(addMultipleToCart([ ...cart ]));\n\t\t\t}\n\n\t\t\tif (!state.cart.length) {\n\t\t\t\tgetCart();\n\t\t\t}\n\t\t},\n\t\t[ state.cart.length, dispatch ]\n\t);\n\n\tuseEffect(\n\t\t() => {\n\t\t\tif (data) {\n\t\t\t\tstripePromise.then((res) => {\n\t\t\t\t\tres.redirectToCheckout({ sessionId: data.checkout.session });\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t[ data ]\n\t);\n\n\tfunction handleToggleCart() {\n\t\tdispatch(toggleCart());\n\t}\n\n\tfunction calculateTotal() {\n\t\tlet sum = 0;\n\t\tstate.cart.forEach((item) => {\n\t\t\tsum += item.price * item.purchaseQuantity;\n\t\t});\n\t\treturn sum.toFixed(2);\n\t}\n\n\tif (!state.cartOpen) {\n\t\treturn (\n\t\t\t<div className=\"cart-closed\" onClick={handleToggleCart}>\n\t\t\t\t<span role=\"img\" aria-label=\"trash\">\n\t\t\t\t\tðŸ›’\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tfunction submitCheckout() {\n\t\tconst productIds = [];\n\n\t\tstate.cart.forEach((item) => {\n\t\t\tfor (let i = 0; i < item.purchaseQuantity; i++) {\n\t\t\t\tproductIds.push(item._id);\n\t\t\t}\n\t\t});\n\n\t\tgetCheckout({\n\t\t\tvariables : { products: productIds }\n\t\t});\n\t}\n\n\treturn (\n\t\t<div className=\"cart\">\n\t\t\t<div className=\"close\" onClick={handleToggleCart}>\n\t\t\t\t[close]\n\t\t\t</div>\n\t\t\t<h2>Shopping Cart</h2>\n\t\t\t{state.cart.length ? (\n\t\t\t\t<div>\n\t\t\t\t\t{state.cart.map((item) => <CartItem key={item._id} item={item} />)}\n\t\t\t\t\t<div className=\"flex-row space-between\">\n\t\t\t\t\t\t<strong>Total: ${calculateTotal()}</strong>\n\t\t\t\t\t\t{Auth.loggedIn() ? (\n\t\t\t\t\t\t\t<button onClick={submitCheckout}>Checkout</button>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<span>(log in to check out)</span>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<h3>\n\t\t\t\t\t<span role=\"img\" aria-label=\"shocked\">\n\t\t\t\t\t\tðŸ˜¨\n\t\t\t\t\t</span>\n\t\t\t\t\tYou haven't added anything to your cart yet\n\t\t\t\t</h3>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n\nexport default Cart;\n"]},"metadata":{},"sourceType":"module"}