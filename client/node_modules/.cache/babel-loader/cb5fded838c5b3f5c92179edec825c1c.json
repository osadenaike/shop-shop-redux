{"ast":null,"code":"var _jsxFileName = \"/Users/oluz/Desktop/shop-shop-redux/client/src/pages/Detail.js\";\nimport React, { useEffect, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useQuery } from '@apollo/react-hooks';\nimport { QUERY_PRODUCTS } from '../utils/queries';\nimport { removeFromCart, updateCartQuantity, addToCart, updateProducts } from '../utils/actions';\nimport { idbPromise } from '../utils/helpers';\nimport spinner from '../assets/spinner.gif';\nimport Cart from '../components/Cart';\n\nfunction Detail() {\n  const state = useSelector(state => state);\n  const {\n    products,\n    cart\n  } = state;\n  const dispatch = useDispatch();\n  const {\n    id\n  } = useParams();\n  const [currentProduct, setCurrentProduct] = useState({});\n  const {\n    loading,\n    data\n  } = useQuery(QUERY_PRODUCTS);\n  useEffect(() => {\n    // already in global store\n    if (products.length) {\n      setCurrentProduct(products.find(product => product._id === id)); // retrieved from server\n    } else if (data) {\n      dispatch(updateProducts(data.products));\n      data.products.forEach(product => {\n        idbPromise('products', 'put', product);\n      }); // get cache from idb\n    } else if (!loading) {\n      idbPromise('products', 'get').then(indexedProducts => {\n        dispatch(updateProducts(indexedProducts));\n      });\n    }\n  }, [products, data, loading, dispatch, id]);\n\n  const addItemToCart = () => {\n    // find the cart item with the matching id\n    const itemInCart = cart.find(cartItem => cartItem._id === id); // if there was a match, call UPDATE with a new purchase quantity\n\n    if (itemInCart) {\n      dispatch(updateCartQuantity(id, parseInt(itemInCart.purchaseQuantity) + 1)); // if we're updating quantity, use existing item data and increment purchaseQuantity value by one\n\n      idbPromise('cart', 'put', { ...itemInCart,\n        purchaseQuantity: parseInt(itemInCart.purchaseQuantity) + 1\n      });\n    } else {\n      dispatch(addToCart({ ...currentProduct,\n        purchaseQuantity: 1\n      })); // if product isn't in the cart yet, add it to the current shopping cart in IndexedDB\n\n      idbPromise('cart', 'put', { ...currentProduct,\n        purchaseQuantity: 1\n      });\n    }\n  };\n\n  const removeItemFromCart = () => {\n    dispatch(removeFromCart(currentProduct._id, cart)); // upon removal from cart, delete the item from IndexedDB using the 'currentProduct._id' to locate what to remove\n\n    idbPromise('cart', 'delete', { ...currentProduct\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, currentProduct ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container my-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 6\n    }\n  }, \"\\u2190 Back to Products\"), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 6\n    }\n  }, currentProduct.name), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 6\n    }\n  }, currentProduct.description), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, \"Price:\"), \"$\", currentProduct.price, ' ', /*#__PURE__*/React.createElement(\"button\", {\n    onClick: addItemToCart,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }\n  }, \"Add to Cart\"), /*#__PURE__*/React.createElement(\"button\", {\n    disabled: !cart.find(p => p._id === currentProduct._id),\n    onClick: removeItemFromCart,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }\n  }, \"Remove from Cart\")), /*#__PURE__*/React.createElement(\"img\", {\n    src: `/images/${currentProduct.image}`,\n    alt: currentProduct.name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 6\n    }\n  })) : null, loading ? /*#__PURE__*/React.createElement(\"img\", {\n    src: spinner,\n    alt: \"loading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 15\n    }\n  }) : null, /*#__PURE__*/React.createElement(Cart, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 4\n    }\n  }));\n}\n\nexport default Detail;","map":{"version":3,"sources":["/Users/oluz/Desktop/shop-shop-redux/client/src/pages/Detail.js"],"names":["React","useEffect","useState","Link","useParams","useSelector","useDispatch","useQuery","QUERY_PRODUCTS","removeFromCart","updateCartQuantity","addToCart","updateProducts","idbPromise","spinner","Cart","Detail","state","products","cart","dispatch","id","currentProduct","setCurrentProduct","loading","data","length","find","product","_id","forEach","then","indexedProducts","addItemToCart","itemInCart","cartItem","parseInt","purchaseQuantity","removeItemFromCart","name","description","price","p","image"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useQuery } from '@apollo/react-hooks';\nimport { QUERY_PRODUCTS } from '../utils/queries';\nimport {\n\tremoveFromCart,\n\tupdateCartQuantity,\n\taddToCart,\n\tupdateProducts\n} from '../utils/actions';\nimport { idbPromise } from '../utils/helpers';\nimport spinner from '../assets/spinner.gif';\n\nimport Cart from '../components/Cart';\n\nfunction Detail() {\n  const state = useSelector((state) => state);\n\tconst { products, cart } = state;\n\n\tconst dispatch = useDispatch();\n\n\tconst { id } = useParams();\n\n\tconst [ currentProduct, setCurrentProduct ] = useState({});\n\n\tconst { loading, data } = useQuery(QUERY_PRODUCTS);\n\n\n\tuseEffect(\n\t\t() => {\n\t\t\t// already in global store\n\t\t\tif (products.length) {\n\t\t\t\tsetCurrentProduct(products.find((product) => product._id === id));\n\t\t\t\t// retrieved from server\n\t\t\t} else if (data) {\n\t\t\t\tdispatch(updateProducts(data.products));\n\n\t\t\t\tdata.products.forEach((product) => {\n\t\t\t\t\tidbPromise('products', 'put', product);\n\t\t\t\t});\n\t\t\t\t// get cache from idb\n\t\t\t} else if (!loading) {\n\t\t\t\tidbPromise('products', 'get').then((indexedProducts) => {\n\t\t\t\t\tdispatch(updateProducts(indexedProducts));\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\t[ products, data, loading, dispatch, id ]\n\t);\n\n\tconst addItemToCart = () => {\n\t\t// find the cart item with the matching id\n\t\tconst itemInCart = cart.find((cartItem) => cartItem._id === id);\n\n\t\t// if there was a match, call UPDATE with a new purchase quantity\n\t\tif (itemInCart) {\n\t\t\tdispatch(updateCartQuantity(id, (parseInt(itemInCart.purchaseQuantity) + 1)));\n\t\t\t// if we're updating quantity, use existing item data and increment purchaseQuantity value by one\n\t\t\tidbPromise('cart', 'put', {\n\t\t\t\t...itemInCart,\n\t\t\t\tpurchaseQuantity : parseInt(itemInCart.purchaseQuantity) + 1\n\t\t\t});\n\t\t} else {\n\t\t\tdispatch(addToCart({ ...currentProduct, purchaseQuantity: 1 }));\n\t\t\t// if product isn't in the cart yet, add it to the current shopping cart in IndexedDB\n\t\t\tidbPromise('cart', 'put', { ...currentProduct, purchaseQuantity: 1 });\n\t\t}\n\t};\n\n\tconst removeItemFromCart = () => {\n\t\tdispatch(removeFromCart(currentProduct._id, cart));\n\n\t\t// upon removal from cart, delete the item from IndexedDB using the 'currentProduct._id' to locate what to remove\n\t\tidbPromise('cart', 'delete', { ...currentProduct });\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t{currentProduct ? (\n\t\t\t\t<div className=\"container my-1\">\n\t\t\t\t\t<Link to=\"/\">‚Üê Back to Products</Link>\n\n\t\t\t\t\t<h2>{currentProduct.name}</h2>\n\n\t\t\t\t\t<p>{currentProduct.description}</p>\n\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<strong>Price:</strong>\n\t\t\t\t\t\t${currentProduct.price}{' '}\n\t\t\t\t\t\t<button onClick={addItemToCart}>Add to Cart</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tdisabled={!cart.find((p) => p._id === currentProduct._id)}\n\t\t\t\t\t\t\tonClick={removeItemFromCart}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tRemove from Cart\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<img\n\t\t\t\t\t\tsrc={`/images/${currentProduct.image}`}\n\t\t\t\t\t\talt={currentProduct.name}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t) : null}\n\t\t\t{loading ? <img src={spinner} alt=\"loading\" /> : null}\n\t\t\t<Cart />\n\t\t</>\n\t);\n}\n\nexport default Detail;\n"]},"metadata":{},"sourceType":"module"}